<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>JSON Comparison Viewer</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="js/lib/zeroclipboard/ZeroClipboard.js" type="text/javascript"></script>
        <script src="js/lib/json3.js" type="text/javascript"></script>
        <script src="js/lib/jquery.js" type="text/javascript"></script>
        <script src="js/lib/bootstrap/js/bootstrap.js" type="text/javascript"></script>
        <link href="js/lib/bootstrap/css/bootstrap-theme.css" rel="stylesheet" type="text/css"/>
        <link href="js/lib/bootstrap/css/bootstrap.css" rel="stylesheet" type="text/css"/>
        <script src="js/wikEd_highlighter.js" type="text/javascript"></script>
        <script src="js/comparison_code.js" type="text/javascript"></script>
        <style>
            .rowSpacer {margin-top: 20px}
            .maxbox {width: 100%; height: 350px; overflow-y: scroll}
            .form-inline > * { margin:15px 15px; }

        </style>
        <script>
            $(document).ready(function () {
                //$('#expected').val(JSON3.stringify(expected, null, 2));
                //$('#actual').val(JSON3.stringify(actual, null, 2));

                function getFailedItems()
                {
                    var res = null;
                    try
                    {
                        $.ajax({
                            dataType: "json",
                            url: 'json/failed_comparisons.json',
                            async: false,
                            data: null,
                            success: function (t) {
                                res = t;

                            },
                            error: function (t)
                            {
                                res = null;
                            }

                        });
                    }
                    catch (e) {
                    }
                    return res;
                }

                failedData = getFailedItems();
                if (failedData !== null)
                {
                    // console.log(JSON3.stringify(failedData,null,2))
                    loadSelections();


                    //set up clipboardcopy

                    var client = new ZeroClipboard(document.getElementById("copy-button"));

                    client.on("ready", function (readyEvent) {
                        // alert( "ZeroClipboard SWF is ready!" );


                        client.on("copy", function (event) {
                            var clipboard = event.clipboardData;
                            var selectIdx = $('#testList').val();

                            var actualStr =
                                    JSON3.stringify(failedData["comparisons"][selectIdx].actual);

                            clipboard.setData("text/plain", actualStr);



                        });
                        client.on("aftercopy", function (event) {
                            // `this` === `client`
                            // `event.target` === the element that was clicked
                            // event.target.style.display = "none";
                            //alert("Copied text to clipboard: " + event.data["text/plain"]);
                        });
                    });
                }
                else
                {
                    $('#mainBody').hide();
                    $('#nothingFound').show();
                }




            });


        </script>

    </head>
    <body>
        <div class="container">
            <div class="row">
                <h3>JSON Comparison Viewer <span style="display:none" id="nothingFound">(Nothing found)</span></h3>
            </div>
            <div id="mainBody">
                <div class="form-inline">

                    <div class="form-group">

                        <label for="testList">Test:</label>
                        <select class="form-control input-lg" id="testList"></select>

                    </div>
                    <div class="form-group">
                        <button class="btn btn-primary" onclick="doCompare()">Compare</button>

                    </div>

                </div>

                <div class="row rowSpacer">
                    <table class="table table-bordered">
                        <thead>
                            <tr><th>Expected</th><th>Actual <a id="copy-button" style="visibility:hidden; font-size: 75%" href="#" class="pull-right"  data-clipboard-text="Copy Me!" title="Click to copy me.">Copy Unformatted to Clipboard</a>  </th><th>Comparison</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td ><textarea readonly  class="maxbox" id="expected"></textarea></td>
                                <td><textarea  readonly  class="maxbox" id="actual"></textarea></td>
                                <td style="width: 33%"><div class="maxbox" id="compare"></div></td>

                            </tr>


                        </tbody>
                    </table>
                </div>


                <div id="legend" style="display:none" class="row">
                    <h4>Legend </h4>

                    <div>
                        <ul>
                            <li><span class="wikEdDiffMarkRight" title="Moved block" id="wikEdDiffMark999" onmouseover="wikEdDiffBlockHandler(undefined, this, 'mouseover');"></span> Original block position</li>
                            <li><span title="+" class="wikEdDiffInsert">Inserted<span class="wikEdDiffSpace"><span class="wikEdDiffSpaceSymbol"></span> </span>text<span class="wikEdDiffNewline"> </span></span></li>
                            <li><span title="−" class="wikEdDiffDelete">Deleted<span class="wikEdDiffSpace"><span class="wikEdDiffSpaceSymbol"></span> </span>text<span class="wikEdDiffNewline"> </span></span></li>
                            <li><span class="wikEdDiffBlockLeft" title="◀" id="wikEdDiffBlock999" onmouseover="wikEdDiffBlockHandler(undefined, this, 'mouseover');">Moved<span class="wikEdDiffSpace"><span class="wikEdDiffSpaceSymbol"></span> </span>block<span class="wikEdDiffNewline"> </span></span></li>
                            <li><span class="newlineSymbol">¶</span> Newline <span class="spaceSymbol">·</span> Space <span class="tabSymbol">→</span> Tab</li>
                        </ul>
                    </div>

                </div>
            </div>


        </div>
    </body>
</html>
